<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Gliko — Trendovi</title>
  <link rel="icon" href="icon-192.png" type="image/png"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="../css/style.css"/>
</head>
<body>

  <!-- Uputstvo modal -->
  <div id="instructionModal" class="modal" hidden>
    <div class="modal-content">
      <div class="modal-head">
        <h3>Dobrodošli u Gliko aplikaciju</h3>
        <button class="close" id="instructionClose">✕</button>
      </div>
      <div class="modal-body">
        <div id="instructionBody"></div>
      </div>
    </div>
  </div>

  <!-- Unos podataka za glukozu -->
  <div class="card form-card">
    <h3>Unesi vrednost glukoze</h3>
    <div class="grid3">
      <div>
        <label>Datum</label>
        <input type="date" id="date">
      </div>
      <div>
        <label>Vreme</label>
        <input type="time" id="time">
      </div>
      <div>
        <label>Glukoza (mmol/L)</label>
        <input type="number" id="glucose" step="0.1" placeholder="npr. 5.8">
      </div>
    </div>
    <div class="mt8">
      <label>Komentar</label>
      <select id="comment">
        <option value="PRE DORUČKA">PRE DORUČKA</option>
        <option value="1.5 - 2 SATA NAKON DORUČKA">1.5 - 2 SATA NAKON DORUČKA</option>
        <option value="PRE RUČKA">PRE RUČKA</option>
        <option value="1.5 - 2 SATA NAKON RUČKA">1.5 - 2 SATA NAKON RUČKA</option>
        <option value="PRE VEČERE">PRE VEČERE</option>
        <option value="1.5 - 2 SATA NAKON VEČERE">1.5 - 2 SATA NAKON VEČERE</option>
        <option value="PRE SPAVANJA">PRE SPAVANJA</option>
        <option value="NAKON FIZIČKE AKTIVNOSTI">NAKON FIZIČKE AKTIVNOSTI</option>
      </select>
    </div>

    <!-- Emoji -->
    <div class="emoji-wrap">
      <div class="emoji-row">
        <label><input type="checkbox" value="🥚"> 🥚</label>
        <label><input type="checkbox" value="🐟"> 🐟</label>
        <label><input type="checkbox" value="🍗"> 🍗</label>
        <label><input type="checkbox" value="🥩"> 🥩</label>
        <label><input type="checkbox" value="🥗"> 🥗</label>
      </div>
      <div class="emoji-row">
        <label><input type="checkbox" value="🍞"> 🍞</label>
        <label><input type="checkbox" value="🍰"> 🍰</label>
        <label><input type="checkbox" value="☕"> ☕</label>
        <label><input type="checkbox" value="🥤"> 🥤</label>
        <label><input type="checkbox" value="🥃"> 🥃</label>
        <label><input type="checkbox" value="🍷"> 🍷</label>
      </div>
    </div>

    <div class="actions">
      <button class="primary" id="btnAdd">➕ Dodaj unos</button>
      <input type="file" id="fileInput" class="file">
      <button id="btnImport">📥 Import CSV</button>
      <button id="btnExport">📤 Export CSV</button>
      <button class="ghost" id="btnClear">🧹 Obriši sve</button>
    </div>
  </div>

  <!-- Stat kartice -->
  <div class="stats">
    <div class="stat prosek">
      <div class="label">Prosek</div>
      <div class="value" id="statAvg">—</div>
    </div>
    <div class="stat min">
      <div class="label">Min</div>
      <div class="value" id="statMin">—</div>
    </div>
    <div class="stat max">
      <div class="label">Maks</div>
      <div class="value" id="statMax">—</div>
    </div>

    <div class="ai-block">
      <button class="ai-btn full-width" id="btnAnalyzeTable">ANALIZA TRENDOVA</button>
      <small class="muted">Ovo nije medicinski savet.</small>
    </div>
  </div>

  <!-- Filteri po dobu dana -->
  <div class="card">
    <h3>Filteri po dobu dana</h3>
    <div class="chip-row">
      <button class="chip" data-zone="jutro">🌄 Jutro (06–09)</button>
      <button class="chip" data-zone="prepodne">🌤️ Pre podne (09–12)</button>
      <button class="chip" data-zone="popodne">☀️ Popodne (12–17)</button>
      <button class="chip" data-zone="vece">🌇 Veče (17–22)</button>
      <button class="chip" data-zone="noc">🌙 Noć (22–06)</button>
      <button class="chip ghost" data-zone="">🔄 Prikaži sve</button>
    </div>

    <div class="date-range">
      <div>
        <label>Početak</label>
        <input type="date" id="startDate">
      </div>
      <div>
        <label>Kraj</label>
        <input type="date" id="endDate">
      </div>
      <button id="btnApplyRange">✅ Primeni period</button>
      <button id="btnResetRange" class="ghost">🔄 Poništi</button>
    </div>
  </div>

  <!-- Grafik -->
  <div class="card">
    <h4>Trend po filterima</h4>
    <canvas id="glucoseChart" height="120"></canvas>
  </div>

  <!-- Tabela -->
  <div class="card">
    <h4>Vaše vrednosti u poslednje vreme</h4>
    <table class="table" id="logTable">
      <thead>
        <tr><th>Datum</th><th>Vreme</th><th>Glukoza</th><th>Komentar</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- AI modal -->
  <div id="aiModal" class="modal" hidden>
    <div class="modal-content">
      <div class="modal-head">
        <h3>AI ANALIZA TRENDA</h3>
        <button class="close" id="aiClose">✕</button>
      </div>
      <div id="aiBody" class="modal-body"></div>
    </div>
  </div>

  <!-- Skripte -->
  <script src="trends.js"></script>
  <script src="ai_current.js"></script>
  <script src="ai_analysis.js"></script>

  <!-- Fix za tipkanje teksta -->
  <script>
// Funkcija za tipkanje poruka liniju po liniju
function typeLine(line, container) {
  return new Promise(resolve => {
    let index = 0;
    const interval = setInterval(() => {
      container.innerHTML += line.charAt(index);
      index++;
      if (index === line.length) {
        clearInterval(interval);
        container.innerHTML += '<br>'; // Dodajemo novi red nakon svake linije
        resolve();
      }
    }, 50); // Brzina kucanja (50ms po karakteru, možeš promeniti ovaj broj)
  });
}

// Tipkanje svih poruka redom
document.addEventListener('DOMContentLoaded', function() {
  const instructionModal = document.getElementById('instructionModal');
  const instructionBody = document.getElementById('instructionBody');

  if (!instructionModal || !instructionBody) return;

  instructionModal.hidden = false;

  // Prošireni niz poruka
  const lines = [
    "Ovde možete pratiti trendove vaših merenja nivoa glukoze,dobiti savete za ishranu i kontrolisati terapiju.",
    "U odgovarajuća polja unesite:",
    " - Vrednost glukoze",
    " - Datum i vreme merenja",
    " - Izaberite komentar o aktivnosti koja je prethodila merenju",
    " - Možete uneti i vrstu hrane koju ste konzumirali da biste pratili uticaj toga šta jedete na vrednost glukoze",
    "AI 'asistent' će uporediti vaše trenutno merenje sa referentnim vrednostima.",
    "Ako imate više merenja, odmah ćete videti njihov prosek vrednosti.",
    "Pritiskom na taster 'ANALIZA TRENDOVA' AI 'asistent' će uporediti sva vaša merenja sa referentnim vrednostima i na njih dati komentar (uzmite u obzir da ovo nije medicinski savet).",
    "U grafikonu i tabeli ispod možete videti sve vaše merene vrednosti koje možete filtrirati po dobu dana. (i grafikon i tabela se ažuriraju na osnovu filtera)"
  ];

  // Tipkanje svih poruka redom
  (async () => {
    for (const line of lines) {
      await typeLine(line, instructionBody);
    }
  })();

  // Zatvori modal
  const closeModalBtn = document.getElementById('instructionClose');
  closeModalBtn.addEventListener('click', function() {
    instructionModal.hidden = true;
  });
});

  </script>

</body>
</html>

