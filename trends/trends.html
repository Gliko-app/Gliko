<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Gliko â€” Trendovi</title>
  <link rel="icon" href="icon-192.png" type="image/png"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="../css/style.css"/>
</head>
<body>

  <!-- Uputstvo modal -->
  <div id="instructionModal" class="modal" hidden>
    <div class="modal-content">
      <div class="modal-head">
        <h3>DobrodoÅ¡li u Gliko aplikaciju</h3>
        <button class="close" id="instructionClose">âœ•</button>
      </div>
      <div class="modal-body">
        <div id="instructionBody"></div>
      </div>
    </div>
  </div>

  <!-- Unos podataka za glukozu -->
  <div class="card form-card">
    <h3>Unesi vrednost glukoze</h3>
    <div class="grid3">
      <div>
        <label>Datum</label>
        <input type="date" id="date">
      </div>
      <div>
        <label>Vreme</label>
        <input type="time" id="time">
      </div>
      <div>
        <label>Glukoza (mmol/L)</label>
        <input type="number" id="glucose" step="0.1" placeholder="npr. 5.8">
      </div>
    </div>
    <div class="mt8">
      <label>Komentar</label>
      <select id="comment">
        <option value="PRE DORUÄŒKA">PRE DORUÄŒKA</option>
        <option value="1.5 - 2 SATA NAKON DORUÄŒKA">1.5 - 2 SATA NAKON DORUÄŒKA</option>
        <option value="PRE RUÄŒKA">PRE RUÄŒKA</option>
        <option value="1.5 - 2 SATA NAKON RUÄŒKA">1.5 - 2 SATA NAKON RUÄŒKA</option>
        <option value="PRE VEÄŒERE">PRE VEÄŒERE</option>
        <option value="1.5 - 2 SATA NAKON VEÄŒERE">1.5 - 2 SATA NAKON VEÄŒERE</option>
        <option value="PRE SPAVANJA">PRE SPAVANJA</option>
        <option value="NAKON FIZIÄŒKE AKTIVNOSTI">NAKON FIZIÄŒKE AKTIVNOSTI</option>
      </select>
    </div>

    <!-- Emoji -->
    <div class="emoji-wrap">
      <div class="emoji-row">
        <label><input type="checkbox" value="ğŸ¥š"> ğŸ¥š</label>
        <label><input type="checkbox" value="ğŸŸ"> ğŸŸ</label>
        <label><input type="checkbox" value="ğŸ—"> ğŸ—</label>
        <label><input type="checkbox" value="ğŸ¥©"> ğŸ¥©</label>
        <label><input type="checkbox" value="ğŸ¥—"> ğŸ¥—</label>
      </div>
      <div class="emoji-row">
        <label><input type="checkbox" value="ğŸ"> ğŸ</label>
        <label><input type="checkbox" value="ğŸ°"> ğŸ°</label>
        <label><input type="checkbox" value="â˜•"> â˜•</label>
        <label><input type="checkbox" value="ğŸ¥¤"> ğŸ¥¤</label>
        <label><input type="checkbox" value="ğŸ¥ƒ"> ğŸ¥ƒ</label>
        <label><input type="checkbox" value="ğŸ·"> ğŸ·</label>
      </div>
    </div>

    <div class="actions">
      <button class="primary" id="btnAdd">â• Dodaj unos</button>
      <input type="file" id="fileInput" class="file">
      <button id="btnImport">ğŸ“¥ Import CSV</button>
      <button id="btnExport">ğŸ“¤ Export CSV</button>
      <button class="ghost" id="btnClear">ğŸ§¹ ObriÅ¡i sve</button>
    </div>
  </div>

  <!-- Stat kartice -->
  <div class="stats">
    <div class="stat prosek">
      <div class="label">Prosek</div>
      <div class="value" id="statAvg">â€”</div>
    </div>
    <div class="stat min">
      <div class="label">Min</div>
      <div class="value" id="statMin">â€”</div>
    </div>
    <div class="stat max">
      <div class="label">Maks</div>
      <div class="value" id="statMax">â€”</div>
    </div>

    <div class="ai-block">
      <button class="ai-btn full-width" id="btnAnalyzeTable">ANALIZA TRENDOVA</button>
      <small class="muted">Ovo nije medicinski savet.</small>
    </div>
  </div>

  <!-- Filteri po dobu dana -->
  <div class="card">
    <h3>Filteri po dobu dana</h3>
    <div class="chip-row">
      <button class="chip" data-zone="jutro">ğŸŒ„ Jutro (06â€“09)</button>
      <button class="chip" data-zone="prepodne">ğŸŒ¤ï¸ Pre podne (09â€“12)</button>
      <button class="chip" data-zone="popodne">â˜€ï¸ Popodne (12â€“17)</button>
      <button class="chip" data-zone="vece">ğŸŒ‡ VeÄe (17â€“22)</button>
      <button class="chip" data-zone="noc">ğŸŒ™ NoÄ‡ (22â€“06)</button>
      <button class="chip ghost" data-zone="">ğŸ”„ PrikaÅ¾i sve</button>
    </div>

    <div class="date-range">
      <div>
        <label>PoÄetak</label>
        <input type="date" id="startDate">
      </div>
      <div>
        <label>Kraj</label>
        <input type="date" id="endDate">
      </div>
      <button id="btnApplyRange">âœ… Primeni period</button>
      <button id="btnResetRange" class="ghost">ğŸ”„ PoniÅ¡ti</button>
    </div>
  </div>

  <!-- Grafik -->
  <div class="card">
    <h4>Trend po filterima</h4>
    <canvas id="glucoseChart" height="120"></canvas>
  </div>

  <!-- Tabela -->
  <div class="card">
    <h4>VaÅ¡e vrednosti u poslednje vreme</h4>
    <table class="table" id="logTable">
      <thead>
        <tr><th>Datum</th><th>Vreme</th><th>Glukoza</th><th>Komentar</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- AI modal -->
  <div id="aiModal" class="modal" hidden>
    <div class="modal-content">
      <div class="modal-head">
        <h3>AI ANALIZA TRENDA</h3>
        <button class="close" id="aiClose">âœ•</button>
      </div>
      <div id="aiBody" class="modal-body"></div>
    </div>
  </div>

  <!-- Skripte -->
  <script src="trends.js"></script>
  <script src="ai_current.js"></script>
  <script src="ai_analysis.js"></script>

  <!-- Fix za tipkanje teksta -->
  <script>
// Funkcija za tipkanje poruka liniju po liniju
function typeLine(line, container) {
  return new Promise(resolve => {
    let index = 0;
    const interval = setInterval(() => {
      container.innerHTML += line.charAt(index);
      index++;
      if (index === line.length) {
        clearInterval(interval);
        container.innerHTML += '<br>'; // Dodajemo novi red nakon svake linije
        resolve();
      }
    }, 50); // Brzina kucanja (50ms po karakteru, moÅ¾eÅ¡ promeniti ovaj broj)
  });
}

// Tipkanje svih poruka redom
document.addEventListener('DOMContentLoaded', function() {
  const instructionModal = document.getElementById('instructionModal');
  const instructionBody = document.getElementById('instructionBody');

  if (!instructionModal || !instructionBody) return;

  instructionModal.hidden = false;

  // ProÅ¡ireni niz poruka
  const lines = [
    "Ovde moÅ¾ete pratiti trendove vaÅ¡ih merenja nivoa glukoze,dobiti savete za ishranu i kontrolisati terapiju.",
    "U odgovarajuÄ‡a polja unesite:",
    " - Vrednost glukoze",
    " - Datum i vreme merenja",
    " - Izaberite komentar o aktivnosti koja je prethodila merenju",
    " - MoÅ¾ete uneti i vrstu hrane koju ste konzumirali da biste pratili uticaj toga Å¡ta jedete na vrednost glukoze",
    "AI 'asistent' Ä‡e uporediti vaÅ¡e trenutno merenje sa referentnim vrednostima.",
    "Ako imate viÅ¡e merenja, odmah Ä‡ete videti njihov prosek vrednosti.",
    "Pritiskom na taster 'ANALIZA TRENDOVA' AI 'asistent' Ä‡e uporediti sva vaÅ¡a merenja sa referentnim vrednostima i na njih dati komentar (uzmite u obzir da ovo nije medicinski savet).",
    "U grafikonu i tabeli ispod moÅ¾ete videti sve vaÅ¡e merene vrednosti koje moÅ¾ete filtrirati po dobu dana. (i grafikon i tabela se aÅ¾uriraju na osnovu filtera)"
  ];

  // Tipkanje svih poruka redom
  (async () => {
    for (const line of lines) {
      await typeLine(line, instructionBody);
    }
  })();

  // Zatvori modal
  const closeModalBtn = document.getElementById('instructionClose');
  closeModalBtn.addEventListener('click', function() {
    instructionModal.hidden = true;
  });
});

  </script>

</body>
</html>

